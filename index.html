<!DOCTYPE html>
<html>
<head>
<style>
#probContainer {
    position: relative;
    width: 250px;
    height: 250px;
    margin: auto;
}
#probValue {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 32px;
    font-weight: bold;
    pointer-events: none;
}
</style>
</head>
<body>

<div id="probContainer">
    <canvas id="probRing" width="250" height="250"></canvas>
    <div id="probValue">50%</div>
</div>

<script>
// canvas setup
let canvas = document.getElementById("probRing");
let ctx = canvas.getContext("2d");
let valueDisplay = document.getElementById("probValue");

let radius = 110;
let lineWidth = 20;
let p = 0.5;
let dragging = false;

// draw ring
function drawRing() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // background circle
    ctx.beginPath();
    ctx.arc(125, 125, radius, 0, 2 * Math.PI);
    ctx.strokeStyle = "#ddd";
    ctx.lineWidth = lineWidth;
    ctx.stroke();

    // filled probability arc
    ctx.beginPath();
    ctx.arc(125, 125, radius, -Math.PI/2, (2 * Math.PI * p) - Math.PI/2);
    ctx.strokeStyle = "#4A90E2";
    ctx.lineWidth = lineWidth;
    ctx.stroke();

    // value indicator
    valueDisplay.textContent = Math.round(p * 100) + "%";
}

// update p value smoothly from mouse location
function updateValueFromEvent(e) {
    let rect = canvas.getBoundingClientRect();
    let x = (e.clientX || e.touches?.[0].clientX) - rect.left - 125;
    let y = (e.clientY || e.touches?.[0].clientY) - rect.top - 125;

    let angle = Math.atan2(y, x);

    // normalize angle to [0, 1]
    let newP = (angle + Math.PI/2) / (2 * Math.PI);
    if (newP < 0) newP += 1;
    if (newP > 1) newP -= 1;

    p = newP;
    drawRing();
}

// event listeners
canvas.addEventListener("mousedown", () => dragging = true);
canvas.addEventListener("mouseup", () => dragging = false);
canvas.addEventListener("mouseleave", () => dragging = false);

canvas.addEventListener("mousemove", (e) => {
    if (dragging) updateValueFromEvent(e);
});

// mobile support
canvas.addEventListener("touchstart", () => dragging = true);
canvas.addEventListener("touchend", () => dragging = false);
canvas.addEventListener("touchmove", (e) => {
    if (dragging) {
        e.preventDefault();
        updateValueFromEvent(e);
    }
});

drawRing();
</script>

</body>
</html>
